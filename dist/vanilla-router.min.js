/**
 * Router@1.2.5
 * author: Graidenix
 */
!function(t){"use strict";function e(e){var r=this._getSettings(e);return this.routes=r.routes,this.notFoundHandler=r.page404,this.mode=t.history&&t.history.pushState?r.mode:"hash",this.root="/"===r.root?"/":"/"+this._trimSlashes(r.root)+"/",this.beforeHook=r.hooks.before,this.securityHook=r.hooks.secure,this._pageState=null,this._currentPage=null,this._skipCheck=!1,this._action=null,"hash"===this.mode&&(this._historyStack=[],this._historyIdx=0,this._historyState="add"),this}e.Page=function(t,e,r,s,o){this.uri=t||"",this.query=e||{},this.params=r||[],this.state=s||null,this.options=o||{}},e.prototype._getSettings=function(t){var e={},r={routes:[],mode:"history",root:"/",hooks:{before:function(){},secure:function(){return!0}},page404:function(t){console.error({page:t,message:"404. Page not found"})}};return t=t||{},["routes","mode","root","page404"].forEach(function(s){e[s]=t[s]||r[s]}),e.hooks=Object.assign({},r.hooks,t.hooks||{}),e},e.prototype._getHistoryFragment=function(){var e=decodeURI(t.location.pathname);return"/"!==this.root&&(e=e.replace(this.root,"")),this._trimSlashes(e)},e.prototype._getHashFragment=function(){var e=t.location.hash.substr(1).replace(/(\?.*)$/,"");return this._trimSlashes(e)},e.prototype._getFragment=function(){return"history"===this.mode?this._getHistoryFragment():this._getHashFragment()},e.prototype._trimSlashes=function(t){return"string"!=typeof t?"":t.toString().replace(/\/$/,"").replace(/^\//,"")},e.prototype._page404=function(t){this._currentPage=new e.Page(t),this.notFoundHandler(t)},e.prototype._parseRouteRule=function(t){if("string"!=typeof t)return t;var e=this._trimSlashes(t).replace(/([\\\/\-\_\.])/g,"\\$1").replace(/\{[a-zA-Z]+\}/g,"(:any)").replace(/\:any/g,"[\\w\\-\\_\\.]+").replace(/\:word/g,"[a-zA-Z]+").replace(/\:num/g,"\\d+");return new RegExp("^"+e+"$","i")},e.prototype._parseQuery=function(t){var e={};return"string"!=typeof t?e:("?"===t[0]&&(t=t.substr(1)),this._queryString=t,t.split("&").forEach(function(t){var r=t.split("=");""!==r[0]&&(void 0===r[1]&&(r[1]=!0),e[decodeURIComponent(r[0])]=r[1])}),e)},e.prototype._getHistoryQuery=function(){return this._parseQuery(t.location.search)},e.prototype._getHashQuery=function(){var e=t.location.hash.indexOf("?"),r=-1!==e?t.location.hash.substr(e):"";return this._parseQuery(r)},e.prototype._getQuery=function(){return"history"===this.mode?this._getHistoryQuery():this._getHashQuery()},e.prototype.add=function(t,e,r){return this.routes.push({rule:this._parseRouteRule(t),handler:e,options:r}),this},e.prototype.remove=function(t){var e=this;return"string"==typeof t&&(t=this._parseRouteRule(t).toString()),this.routes.some(function(r,s){return(r.handler===t||r.rule.toString()===t)&&(e.routes.splice(s,1),!0)}),this},e.prototype.reset=function(){return this.routes=[],this.mode=null,this.root="/",this._pageState={},this.removeUriListener(),this},e.prototype._pushHistory=function(){var t=this,e=this._getFragment();"hash"===this.mode&&("add"===this._historyState&&(this._historyIdx!==this._historyStack.length-1&&this._historyStack.splice(this._historyIdx+1),this._historyStack.push({path:e,state:t._pageState}),this._historyIdx=this._historyStack.length-1),this._historyState="add")},e.prototype._unloadCallback=function(t){var e;return this._skipCheck?!t||Promise.resolve(!0):this._currentPage&&this._currentPage.options&&this._currentPage.options.unloadCb?(e=this._currentPage.options.unloadCb(this._currentPage,t),!t||e instanceof Promise?e:e?Promise.resolve(e):Promise.reject(e)):!t||Promise.resolve(!0)},e.prototype._findRoute=function(){var r=this,s=this._getFragment();return this.routes.some(function(o){var i=s.match(o.rule);if(i){i.shift();var n=r._getQuery(),h=new e.Page(s,n,i,r._pageState,o.options);return!!r.securityHook(h)&&(r._currentPage=h,r._skipCheck?(r._skipCheck=!1,!0):(r.beforeHook(h),o.handler.apply(h,i),r._pageState=null,t.onbeforeunload=function(t){if(!r._unloadCallback(!1))return t.returnValue=!0,!0},!0))}return!1})},e.prototype._treatAsync=function(){var t;(t=this._currentPage.options.unloadCb(this._currentPage,!0))instanceof Promise||(t=t?Promise.resolve(t):Promise.reject(t)),t.then(this._processUri.bind(this)).catch(this._resetState.bind(this))},e.prototype._resetState=function(){this._skipCheck=!0,this.navigateTo(this._current,this._currentPage.state,!0)},e.prototype._processUri=function(){var t=this._getFragment();this._current=t,this._pushHistory(),this._findRoute.call(this)||this._page404(t)},e.prototype.check=function(){return this._skipCheck?this:(this._currentPage&&this._currentPage.options&&this._currentPage.options.unloadCb?this._treatAsync():this._processUri(),this)},e.prototype.addUriListener=function(){return"history"===this.mode?t.onpopstate=this.check.bind(this):t.onhashchange=this.check.bind(this),this},e.prototype.removeUriListener=function(){return t.onpopstate=null,t.onhashchange=null,this},e.prototype.navigateTo=function(e,r,s){return e=this._trimSlashes(e)||"",this._pageState=r||null,this._skipCheck=!!s,"history"===this.mode?(history.pushState(r,null,this.root+this._trimSlashes(e)),this.check()):(t.location.hash=e,this)},e.prototype.refresh=function(){if(!this._currentPage)return this;var t=this._currentPage.uri+"?"+this._queryString;return this.navigateTo(t,this._currentPage.state)},e.prototype.back=function(){return"history"===this.mode?(t.history.back(),this):this.go(this._historyIdx-1)},e.prototype.forward=function(){return"history"===this.mode?(t.history.forward(),this):this.go(this._historyIdx+1)},e.prototype.go=function(e){if("history"===this.mode)return t.history.go(e),this;var r=this._historyStack[e];return r?(this._historyIdx=e,this._historyState="hold",this.navigateTo(r.path,r.state)):this},t.Router=e}(window);